{% extends "web/base.html" %}
{% block content %}

<h1>Productos</h1>

<section class="card">
  <h2>Crear producto</h2>
  <form action="/web/productos" method="post" enctype="multipart/form-data" class="form-grid">
    <label>Nombre
      <input type="text" name="nombre" required minlength="2" maxlength="80">
    </label>
    <label>Categoría
      <input type="text" name="categoria" required minlength="2" maxlength="40">
    </label>
    <label>Marca
      <input type="text" name="marca" required minlength="1" maxlength="40">
    </label>
    <label>Cantidad
      <input type="number" name="cantidad" required min="0" step="1">
    </label>
    <label>Precio de venta
      <input type="number" name="precio_venta" required min="0.01" step="0.01">
    </label>
    <label>Imagen (opcional)
      <input type="file" name="imagen" accept="image/*">
    </label>
    <button type="submit">Crear producto</button>
  </form>
</section>

<section class="card">
  <h2>Listado</h2>

  <form action="/web/productos" method="get" class="row" style="gap:.5rem; margin-bottom: .5rem;">
    <input type="text" name="q" value="{{ q }}" placeholder="Buscar por nombre...">
    <button type="submit">Buscar</button>
  </form>

  {% if productos %}
  <div class="table-responsive">
    <table>
      <thead>
        <tr>
          <th>ID</th><th>Nombre</th><th>Categoría</th><th>Marca</th><th>Cantidad</th><th>Precio</th><th>Imagen</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      {% for p in productos %}
        <tr>
          <td>{{ p.id_producto }}</td>
          <td>{{ p.nombre }}</td>
          <td>{{ p.categoria }}</td>
          <td>{{ p.marca }}</td>
          <td>{{ p.cantidad }}</td>
          <td>{{ '%.2f'|format(p.precio_venta or 0) }}</td>
          <td>
            {% if p.imagen_url %}
              <img src="{{ p.imagen_url }}" alt="img {{ p.nombre }}" style="height:40px;">
            {% else %}
              —
            {% endif %}
          </td>
          <td>
            <form action="/web/productos/{{ p.id_producto }}/delete" method="post" onsubmit="return confirm('¿Eliminar producto?');">
              <button type="submit">Eliminar</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No hay productos.</p>
  {% endif %}
</section>

{% endblock %}
