<!-- app/templates/web/productos.html -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Productos</title>
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    body{font-family:system-ui, Arial, sans-serif; margin:24px;}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:16px; margin-top:16px;}
    .card{border:1px solid #e5e7eb; border-radius:10px; padding:14px;}
    .muted{color:#6b7280; font-size:12px;}
    .price{font-weight:600}
    img{max-width:100%; height:160px; object-fit:contain; background:#fafafa; border:1px dashed #e5e7eb; border-radius:8px}
    form.card{display:grid; gap:10px; max-width:520px}
    input,button{padding:10px; border:1px solid #e5e7eb; border-radius:8px}
    button{cursor:pointer; background:#111827; color:#fff}
    .toolbar{display:flex; gap:8px; align-items:center; margin-bottom:12px}
    .danger{background:#991b1b}
    a.button{display:inline-block; padding:10px 14px; background:#374151; color:#fff; border-radius:8px; text-decoration:none}
  </style>
</head>
<body>
  <h1>Productos</h1>
  <p class="muted">Crear y listar productos (las imágenes se guardan en Supabase Storage y aquí solo almacenamos la URL).</p>

  <div class="toolbar">
    <a class="button" href="/">Inicio</a>
    <a class="button" href="/web/usuarios">Usuarios</a>
    <a class="button" href="/docs">Swagger</a>
  </div>

  <!-- Buscador -->
  <form method="get" action="/web/productos" class="card">
    <label>Búsqueda</label>
    <input type="text" name="q" placeholder="Nombre, categoría o marca" value="{{ q }}">
    <button type="submit">Buscar</button>
  </form>

  <!-- Form nuevo producto -->
  <form method="post" action="/web/productos" enctype="multipart/form-data" class="card" style="margin-top:16px">
    <h2>Nuevo producto</h2>
    <input name="nombre" placeholder="Nombre" required>
    <input name="categoria" placeholder="Categoría" required>
    <input name="marca" placeholder="Marca" required>
    <input type="number" name="cantidad" placeholder="Cantidad" min="0" required>
    <input type="number" step="0.01" name="precio_venta" placeholder="Precio de venta" min="0" required>
    <input type="file" name="imagen" accept="image/*">
    <button type="submit">Guardar</button>
  </form>

  <h2 style="margin-top:22px">Listado</h2>
  <div class="grid">
    {% for p in productos %}
      <div class="card">
        {% if p.imagen_url %}
          <img src="{{ p.imagen_url }}" alt="{{ p.nombre }}">
        {% endif %}
        <h3>{{ p.nombre }}</h3>
        <div class="muted">{{ p.categoria }} · {{ p.marca }}</div>
        <div class="muted">Stock: {{ p.cantidad }}</div>
        <div class="price">$ {{ '%.0f'|format(p.precio_venta) }}</div>

        <form method="post" action="/web/productos/{{ p.id_producto }}/delete" onsubmit="return confirm('¿Eliminar definitivamente?')">
          <button class="danger" type="submit">Eliminar</button>
        </form>
      </div>
    {% else %}
      <p class="muted">Sin resultados.</p>
    {% endfor %}
  </div>
</body>
</html>
