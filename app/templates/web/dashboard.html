{% extends "web/base.html" %}
{% block content %}

<h1>Dashboard</h1>

<section class="kpis row" style="gap:1rem;">
  <div class="card">
    <div class="muted">Unidades vendidas</div>
    <div class="h4 mb-0">{{ top|sum(attribute='total_vendido') }}</div>
  </div>
  <div class="card">
    <div class="muted">Monto total ($)</div>
    <div class="h4 mb-0">{{ '%.2f'|format(resumen.get('monto_total', 0)) }}</div>
  </div>
  <div class="card">
    <div class="muted">Ticket promedio ($)</div>
    <div class="h4 mb-0">{{ '%.2f'|format(resumen.get('ticket_promedio', 0)) }}</div>
  </div>
</section>

<section class="row" style="gap:1rem;">
  <div class="card" style="flex:1;">
    <h2>Top 10 más vendidos</h2>
    {% if top %}
    <div class="table-responsive">
      <table>
        <thead>
          <tr><th>Producto</th><th>Unidades</th><th>Ingresos ($)</th></tr>
        </thead>
        <tbody>
          {% for r in top %}
          <tr>
            <td>{{ r.nombre }}</td>
            <td>{{ r.total_vendido }}</td>
            <td>{{ '%.2f'|format(r.total_ingresos or 0) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <p>No hay datos aún.</p>
    {% endif %}
  </div>

  <div class="card" style="flex:1;">
    <h2>10 menos vendidos</h2>
    {% if bottom %}
    <div class="table-responsive">
      <table>
        <thead>
          <tr><th>Producto</th><th>Unidades</th></tr>
        </thead>
        <tbody>
          {% for r in bottom %}
          <tr>
            <td>{{ r.nombre }}</td>
            <td>{{ r.total_vendido }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <p>No hay datos aún.</p>
    {% endif %}
  </div>
</section>

<form action="/web/dashboard/rebuild" method="post" style="margin-top:1rem;">
  <button type="submit">Recalcular resúmenes</button>
</form>

{% endblock %}
