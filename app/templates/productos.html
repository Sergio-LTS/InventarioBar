<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Productos · Inventariobar</title>
  <style>
    body { font-family: system-ui, Arial; margin: 24px; }
    h1 { margin-bottom: 8px; }
    form { display: grid; gap: 8px; max-width: 520px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
    label { display: grid; gap: 4px; font-size: 14px; }
    input[type="text"], input[type="number"], input[type="file"] { padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
    button { padding: 10px 14px; border: 0; border-radius: 6px; cursor: pointer; background: #111827; color: #fff; }
    .grid { margin-top: 24px; display: grid; gap: 12px; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); }
    .card { border: 1px solid #eee; border-radius: 8px; padding: 10px; }
    .card img { width: 100%; height: 150px; object-fit: cover; border-radius: 6px; background: #f6f6f6; }
    .meta { color: #666; font-size: 13px; }
  </style>
</head>
<body>
  <h1>Productos</h1>
  <p class="meta">Crear y listar productos (las imágenes se guardan en Supabase Storage y aquí solo almacenamos la URL).</p>

  <h2>Nuevo producto</h2>
  <form action="/web/productos/nuevo" method="post" enctype="multipart/form-data">
    <label>Nombre
      <input name="nombre" type="text" required />
    </label>
    <label>Categoría
      <input name="categoria" type="text" />
    </label>
    <label>Marca
      <input name="marca" type="text" />
    </label>
    <label>Cantidad
      <input name="cantidad" type="number" min="0" required />
    </label>
    <label>Precio de venta
      <input name="precio_venta" type="number" step="0.01" min="0" required />
    </label>
    <label>Imagen
      <input name="imagen" type="file" accept="image/*" />
    </label>
    <button type="submit">Guardar</button>
  </form>

  <h2 style="margin-top:24px;">Listado</h2>
  <section class="grid">
    {% for p in productos %}
      <article class="card">
        {% if p.imagen_url %}
          <img src="{{ p.imagen_url }}" alt="{{ p.nombre }}" />
        {% endif %}
        <h3>{{ p.nombre }}</h3>
        <div class="meta">{{ p.categoria or '—' }} · {{ p.marca or '—' }}</div>
        <div>Stock: <b>{{ p.cantidad }}</b></div>
        <div>$ {{ '%.0f'|format(p.precio_venta) }}</div>
      </article>
    {% else %}
      <p>No hay productos.</p>
    {% endfor %}
  </section>
</body>
</html>
>